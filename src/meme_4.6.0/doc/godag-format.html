<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"
>
<html>
  <head>
    <title>GO DAG Format</title>
    <link href="./meme-suite.css" rel="stylesheet" type="text/css" />
    <link rel="icon" type="image/png" href="../images/memesuite_icon.png">
    <style>
    div.code {
      border-style: solid;
      border-width: 2px;
      padding-top:5px;
      padding-bottom:5px;
      padding-right:5px;
      padding-left:5px;
      font-family: monospace;
    }
    .comment {
      color: green;
    }
    table {
      margin-top: 10px;
      margin-bottom: 10px;
    }
    </style>
  </head>
  <body>
    <div id="main">
      <script src="./meme-suite-logo.js" type="text/javascript">></script>
      <h1>GO DAG file format</h1>
      <p>
      The GO DAG file format is used by <a href="gomo_highlight.html" ><code>gomo_highlight</code></a> 
      and <a href="gomo.html" ><code>gomo</code></a>. 
      It is a quick parsing file, containing the structure and IDs from the Gene Ontology and can be 
      <a href="#obo2dag" >automatically generated</a> from the 
      <a href="http://www.geneontology.org/GO.format.obo-1_2.shtml" >Gene Ontology's OBO format</a>. 
      A GO DAG file is packaged with the gomo databases avaliable on the meme website.<br />
      <br />
      </p>

      <hr />

      <h2>File Structure</h2>
      <p>
      The file structure can be divided into 3 major parts.
      </p>
      <ol>
        <li>Header Comments</li>
        <li>Directed Acyclic Graph</li>
        <li>Graph Labels</li>
      </ol>
      <h3>Header Comments</h3>
      <p>
      The purpose of the header comments is to document the details of the OBO file that was used to generate it.
      Each line starts with a # symbol and the rest of the line can contain any content.
      <div class="code" >
      <span class="comment" >
      # Generated from an OBO file with the details:<br />
      # OBO Format Version: 1.2<br />
      # OBO Date: Fri Sep 25 11:40:00 EST 2009<br />
      # OBO Saved By: jane<br />
      # OBO Autogenerated By: OBO-Edit 2.1-beta1<br />
      # OBO Remark: cvs version: $Revision: 1.804 $<br />
      </span>
      </div>
      </p>
      <h3>Directed Acyclic Graph</h3>
      <p>
      The purpose of the directed acyclic graph portion is to store the hierarchical structure of the 
      Gene Ontology in a way that is quick to load into memory while still being compact in file size.
      The first line is the number of nodes in the DAG. Following that lines are in groups of 5 defining
      different attributes of the node. The group is on its own in the first line. The name is on the second
      line with the length coming first so memory can be preallocated for it. The node's position in the
      DAG is summarized in the third line with the total number of nodes above followed by the total number
      or nodes below. The fourth and fifth lines define the edges from the node to its parents and edges 
      from the node to its children. Each line of edges starts with the edge count for that line which can 
      be zero. Each edge is a number in the range zero to the node count minus 1 and is the index of the 
      linked node. Values on the same line are tab seperated. The order that the nodes are listed does 
      not have any meaning other than providing a position to for the other nodes to link to.
      <div class="code" >
        node_count<br />
        node_1_group<br />
        node_1_name_length&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>tab</b> node_1_name<br />
        node_1_nodes_above&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>tab</b> node_1_nodes_below<br />
        node_1_parent_edge_count      [ <b>tab</b>&nbsp;node_1_parent_1       ( <b>tab</b> node_1_parent_w      )* ]<br />
        node_1_child_edge_count&nbsp; [ <b>tab</b>&nbsp;node_1_child_1&nbsp;  ( <b>tab</b> node_1_child_x&nbsp; )* ]<br />
        ...<br />
        node_n_group<br />
        node_n_name_length&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>tab</b> node_n_name<br />
        node_n_nodes_above&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>tab</b> node_n_nodes_below<br />
        node_n_parent_edge_count      [ <b>tab</b>&nbsp;node_n_parent_1       ( <b>tab</b> node_n_parent_y      )* ]<br />
        node_n_child_edge_count&nbsp; [ <b>tab</b>&nbsp;node_n_child_1&nbsp;  ( <b>tab</b> node_n_child_z&nbsp; )* ]<br />
      </div>
      </p>
      <h3>Graph Labels</h3>
      <p>
      The purpose of the graph labels is to allow lookup of a graph node. Each line in the graph labels section has
      a symbol indicating if the label is the primary (&gt;) or alternate (+) label, followed by a tab, followed by the label, 
      followed by a tab, followed by the position of the associated node (index plus 1) or zero if the label is obsolete.
      The labels are ordered alphabetically.
      <div class="code" >
        label_count<br />
        &gt; <b>tab</b> label_AA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <b>tab</b> position_of_node_AA<br />
        &gt; <b>tab</b> label_AB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <b>tab</b> position_of_node_AB<br />
        &gt; <b>tab</b> label_AC_obsolete                                               <b>tab</b> 0<br />
              ...<br />
        +    <b>tab</b> label_ZZ_alt_id&nbsp;&nbsp;  <b>tab</b> position_of_node_AB<br />
      </div>
      <br />
      </p>

      <hr />

      <h2>Simple Example</h2>
      <p>
      Suppose there were the nodes A, B, C, D with the alternate names G,E,H,F and an obsolete name Z 
      all from the grouping 'example' which I will shorten to x.
      <table border="1">
        <tr>
          <th>Node Name</th><th>Alternate Names</th><th>Parent Nodes</th><th>Child Nodes</th><th>Group</th><th>Nodes Above</th><th>Nodes Below</th>
        </tr>
        <tr>
          <td>A</td><td>G</td><td></td><td>B, D</td><td>x</td><td>0</td><td>3</td>
        </tr>
        <tr>
          <td>B</td><td>E</td><td>A</td><td>C</td><td>x</td><td>1</td><td>1</td>
        </tr>
        <tr>
          <td>C</td><td>H</td><td>B</td><td></td><td>x</td><td>2</td><td>0</td>
        </tr>
        <tr>
          <td>D</td><td>F</td><td>A</td><td></td><td>x</td><td>1</td><td>0</td>
        </tr>
      </table>
      <p>So one possible output for this example would be as follows. Note that this example 
      simulates tabs as tabs don't display properly in html.</p>
      <div class="code" >
        <span class="comment"># Simple example header</span><br />
        4<br />
        <span style="color:red" >
        x<br />
        35&nbsp;&nbsp;&nbsp;The full descriptive name of node C<br />
        2&nbsp;&nbsp;&nbsp;&nbsp;0<br />
        1&nbsp;&nbsp;&nbsp;&nbsp;3<br />
        0<br />
        </span>
        <span style="color:orange" >
        x<br />
        46&nbsp;&nbsp;&nbsp;Another descriptive name, this time for node A<br />
        0&nbsp;&nbsp;&nbsp;&nbsp;3<br />
        0<br />
        2&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;2<br />
        </span>
        <span style="color:blue" >
        x<br />
        38&nbsp;&nbsp;&nbsp;Meaningful descriptive name for node D<br />
        1&nbsp;&nbsp;&nbsp;&nbsp;0<br />
        1&nbsp;&nbsp;&nbsp;&nbsp;1<br />
        0<br />
        </span>
        <span style="color:purple" >
        x<br />
        21&nbsp;&nbsp;&nbsp;Node B's name in full<br />
        1&nbsp;&nbsp;&nbsp;&nbsp;1<br />
        1&nbsp;&nbsp;&nbsp;&nbsp;1<br />
        1&nbsp;&nbsp;&nbsp;&nbsp;0<br />
        </span>
        9<br />
        <span style="color:orange">&gt;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;2<br /></span>
        <span style="color:purple">&gt;&nbsp;&nbsp;&nbsp;&nbsp;B&nbsp;&nbsp;&nbsp;&nbsp;4<br /></span>
        <span style="color:red">&gt;&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;1<br /></span>
        <span style="color:blue">&gt;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;3<br /></span>
        <span style="color:purple">+&nbsp;&nbsp;&nbsp;&nbsp;E&nbsp;&nbsp;&nbsp;&nbsp;4<br /></span>
        <span style="color:blue">+&nbsp;&nbsp;&nbsp;&nbsp;F&nbsp;&nbsp;&nbsp;&nbsp;3<br /></span>
        <span style="color:orange">+&nbsp;&nbsp;&nbsp;&nbsp;G&nbsp;&nbsp;&nbsp;&nbsp;2<br /></span>
        <span style="color:red">+&nbsp;&nbsp;&nbsp;&nbsp;H&nbsp;&nbsp;&nbsp;&nbsp;1<br /></span>
        <span style="color:grey">&gt;&nbsp;&nbsp;&nbsp;&nbsp;Z&nbsp;&nbsp;&nbsp;&nbsp;0<br /></span>
      </div>
      <br />
      </p>

      <hr />
      <a name="obo2dag"><h2>Generating from OBO files</h2></a>
      <p>
      If for some reason you can't source the GO DAG file from the meme website then the tool obo2dag 
      is provided in the scripts directory for the purpose of creating GO DAG files. 
      It is an executable jar file with source packaged in the jar. As the OBO file format is
      still under active development we made use of a parser included with the 
      <a href="http://geneontology.sourceforge.net/#obo" >OBO-Edit</a> program which means our program is
      dependent on libraries from OBO-Edit. As this program is not likely to be needed by an end user 
      we have not sought permission to include OBO-Edit's parser and so you will have to source the 
      libraries yourself.
      </p>
      <h3>Required Libraries for obo2dag</h3>
      <p>
      The tool obo2dag is dependent on the OBO-Edit classes:
      </p>
      <ul>
        <li><code>org.obo.dataadapter.OBOParseEngine</code></li>
        <li><code>org.obo.dataadapter.OBOParseException</code></li>
        <li><code>org.obo.dataadapter.OBOParser</code></li>
        <li><code>org.obo.dataadapter.ParseEngine</code></li>
        <li><code>org.obo.datamodel.NestedValue</code></li>
      </ul>
      <p>
      These classes have their own dependancies and it was discovered through a process of trial and error
      that the libraries needed from the OBO-Edit distribution are:
      </p>
      <ul>
        <li>obo.jar</li>
        <li>bbop.jar</li>
        <li>log4j-1.2.15.jar</li>
      </ul>
      <p>
      The current distributions of OBO-Edit seem to only include automated installers (no tar version) and so
      I recommend downloading the RPM version and using a program like 7-zip to extract the files you need.
      I found that the jar files were in the rpm at the location "/./opt/OBO-Edit2/runtime/". Once you have
      the jar files simply run obo2dag in the same folder.
      </p>
      <a name="obo2dag"></a>
      <h3>Running obo2dag</h3>
      <p>
      As stated previously, obo2dag is an executable jar file and so if your system is setup correctly you can
      run it like you would a program and it will bring up the graphical user interface. To run the GUI from the
      command line type:<br />
      <code>java -jar obo2dag.jar</code><br />
      <br />
      If you need to run obo2dag in non-GUI mode then you must specify the class <code>gomo.HierarchyParser</code>
      and pass it the path to the obo file and the path to the output GO DAG file. The command is:<br />
      <code>java -cp obo2dag.jar gomo.DAGParser &lt;GO OBO File&gt; &lt;Output File&gt;</code><br />
      <br />
      </p>
    </div>
  </body>
</html>
